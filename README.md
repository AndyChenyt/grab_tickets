# 大麦网抢票软件使用说明

本项目提供了一个基于 **Python** 和 **Selenium** 的大麦网演唱会门票自动化抢票脚本。它通过模拟用户在浏览器中的操作，实现自动登录、监控开票、快速点击和订单提交，旨在提高抢票效率。

## 1. 免责声明

**重要提示：** 本软件仅供学习和研究网页自动化技术使用，不鼓励任何违反网站服务条款的行为。用户应确保在合法合规的前提下使用本代码。使用本工具可能存在被大麦网反爬虫机制识别和封禁的风险，请自行承担风险。

## 2. 环境准备

在运行本脚本之前，请确保您的系统已安装以下环境和依赖：

| 依赖项 | 版本要求 | 备注 |
| :--- | :--- | :--- |
| **Python** | 3.6 及以上 | 推荐使用最新版本 |
| **Chrome 浏览器** | 最新稳定版 | 必须安装 |
| **Selenium** | 最新稳定版 | Python 库 |
| **ChromeDriver** | 版本需与 Chrome 浏览器版本匹配 | Selenium 会自动管理，无需手动下载 |

### 2.1. 克隆项目

使用 `git` 命令将项目克隆到本地：

```bash
git clone https://github.com/AndyChenyt/grab_tickets.git
cd grab_tickets
```

### 2.2. 安装依赖

进入项目目录后，安装所需的 Python 依赖：

```bash
pip3 install -r requirements.txt
```

## 3. 文件结构

项目主要文件说明：

| 文件名 | 描述 |
| :--- | :--- |
| `damai_snatcher.py` | 抢票软件的核心代码。 |
| `stealth.min.js` | 用于对抗网站反爬虫机制的 JavaScript 脚本。 |
| `README.md` | 本使用说明文档。 |
| `DESIGN.md` | 软件的设计原理和架构说明文档。 |
| `requirements.txt` | Python 依赖清单。 |
| `cookies.pkl` | （首次运行后生成）用于保存您的登录状态，已加入 `.gitignore`。 |

## 4. 使用步骤

### 步骤 1: 配置脚本

打开 `damai_snatcher.py` 文件，修改 `if __name__ == "__main__":` 下的示例配置：

```python
if __name__ == "__main__":
    # 1. 替换为实际演唱会详情页的 URL
    # 示例: target_url = "https://detail.damai.cn/item.htm?id=XXXXXXXXX" 
    target_url = "https://detail.damai.cn/item.htm?id=XXXXXXXXX" 
    
    # 2. 配置观演人姓名列表
    # 确保列表中的姓名与您大麦网账号中已添加的观演人姓名完全一致
    viewer_names = ["张三", "李四"] 
    
    # 3. 初始化并运行抢票程序
    snatcher = DamaiSnatcher(target_url, viewer_names=viewer_names)
    # snatcher.run() # 实际运行时请取消注释
```

**如何获取配置信息：**
*   **`target_url`**: 直接复制您想要抢票的**演唱会详情页**的完整 URL。
*   **`viewer_names`**: 登录大麦网，在“我的”->“观演人”中查看并复制您已添加的观演人**真实姓名**，确保完全一致。

### 步骤 2: 首次运行与登录（生成 Cookie）

1.  在命令行中运行脚本：

    ```bash
    python3 damai_snatcher.py
    ```

2.  脚本将自动打开 Chrome 浏览器，并提示您**扫码登录**。
3.  请在浏览器中完成扫码登录。登录成功后，脚本会自动将您的登录状态（Cookie）保存到项目目录下的 `cookies.pkl` 文件中。
4.  **重要：** 首次运行成功后，请确保 `cookies.pkl` 文件已生成，这标志着您已成功保存登录状态。

### 步骤 3: 抢票执行

1.  在开票前几分钟（建议提前 5-10 分钟），再次运行脚本：

    ```bash
    python3 damai_snatcher.py
    ```

2.  脚本将自动加载 `cookies.pkl` 中的登录状态，并导航到目标演唱会页面。
3.  脚本会进入**监控模式**，持续等待“立即购买”按钮变为可点击状态。
4.  一旦开票，脚本将**自动点击**购买按钮，并尝试**自动勾选**您配置的观演人。
5.  订单提交成功后，浏览器将跳转到支付页面。脚本会打印提示信息，您需要在**限定时间内**手动完成支付。

## 5. 常见问题与注意事项

1.  **反爬虫：** 脚本已注入 `stealth.min.js` 尝试对抗反爬虫，但大麦网的反爬机制会不断更新。如果抢票失败，可能需要更新 `stealth.min.js` 或调整代码逻辑。
2.  **元素定位：** 网站页面结构可能随时变化，如果脚本无法点击或定位元素，请检查 `damai_snatcher.py` 中使用的元素定位器（如 Class Name 或 XPath）是否仍然有效。
3.  **支付：** 抢票软件无法自动完成支付，这是为了保障您的资金安全。请务必在订单提交后，**手动快速完成支付**。
4.  **复杂抢票：** 对于需要**选座**或**多场次/多票档**选择的复杂情况，您可能需要根据实际页面结构，修改 `snatch` 方法中的元素定位逻辑。本脚本提供的是基础自动化框架。
5.  **多线程/多进程：** 本脚本为单线程实现。为避免被封禁，不建议用户自行修改为高并发多线程抢票。
