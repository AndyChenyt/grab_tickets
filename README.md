# 大麦网抢票软件使用说明

## 1. 软件简介

本项目提供了一个基于 **Python** 和 **Selenium** 的大麦网演唱会门票自动化抢票脚本。它通过模拟用户在浏览器中的操作，实现自动登录、监控开票、快速点击和订单提交，旨在提高抢票效率。

## 2. 环境准备

在运行本脚本之前，请确保您的系统已安装以下环境和依赖：

| 依赖项 | 版本要求 | 安装命令 |
| :--- | :--- | :--- |
| **Python** | 3.6 及以上 | 系统自带或自行安装 |
| **Selenium** | 最新稳定版 | `pip3 install selenium` |
| **Chrome 浏览器** | 最新稳定版 | 自行安装 |
| **ChromeDriver** | 版本需与 Chrome 浏览器版本匹配 | Selenium 会自动管理，无需手动下载 |

**安装依赖：**

```bash
pip3 install selenium
```

## 3. 文件结构

您将获得以下文件：

| 文件名 | 描述 |
| :--- | :--- |
| `damai_snatcher.py` | 抢票软件的核心代码。 |
| `stealth.min.js` | 用于对抗网站反爬虫机制的 JavaScript 脚本。 |
| `damai_snatcher_design.md` | 软件的设计原理和架构说明文档。 |
| `damai_snatcher_usage.md` | 本使用说明文档。 |
| `cookies.pkl` | （首次运行后生成）用于保存您的登录状态。 |

## 4. 使用步骤

### 步骤 1: 配置脚本

打开 `damai_snatcher.py` 文件，修改 `if __name__ == "__main__":` 下的示例配置：

```python
if __name__ == "__main__":
    # 1. 替换为实际演唱会详情页的 URL
    target_url = "https://detail.damai.cn/item.htm?id=XXXXXXXXX" 
    
    # 2. 配置观演人姓名列表
    # 确保列表中的姓名与您大麦网账号中已添加的观演人姓名完全一致
    viewer_names = ["张三", "李四"] 
    
    # 3. 初始化并运行抢票程序
    snatcher = DamaiSnatcher(target_url, viewer_names=viewer_names)
    snatcher.run()
```

**重要提示：** 脚本目前默认选择页面上第一个可点击的“立即购买”按钮，并尝试勾选配置的观演人。对于需要**选座**或**多场次/多票档**选择的复杂情况，您可能需要根据实际页面结构，修改 `snatch` 方法中的元素定位逻辑。

### 步骤 2: 首次运行与登录

1.  在命令行中运行脚本：

    ```bash
    python3 damai_snatcher.py
    ```

2.  脚本将自动打开 Chrome 浏览器。
3.  如果本地没有 `cookies.pkl` 文件，脚本会跳转到登录页，并提示您**扫码登录**。
4.  请在浏览器中完成扫码登录。登录成功后，脚本会自动保存您的 Cookie 到 `cookies.pkl` 文件，实现免登录。

### 步骤 3: 抢票执行

1.  在开票前几分钟，再次运行脚本：

    ```bash
    python3 damai_snatcher.py
    ```

2.  脚本将加载您的登录状态，并导航到目标演唱会页面。
3.  脚本会进入**监控模式**，持续等待“立即购买”按钮变为可点击状态。
4.  一旦开票，脚本将**自动点击**购买按钮，并尝试**自动勾选**您配置的观演人。
5.  订单提交成功后，浏览器将跳转到支付页面。脚本会打印提示信息，您需要在**限定时间内**手动完成支付。

## 5. 常见问题与注意事项

1.  **反爬虫：** 脚本已注入 `stealth.min.js` 尝试对抗反爬虫，但大麦网的反爬机制会不断更新。如果抢票失败，可能是反爬机制升级导致。
2.  **元素定位：** 网站页面结构可能随时变化，如果脚本无法点击或定位元素，请检查 `damai_snatcher.py` 中使用的 XPath 或 Class Name 是否仍然有效。
3.  **支付：** 抢票软件无法自动完成支付，这是为了保障您的资金安全。请务必在订单提交后，**手动快速完成支付**。
4.  **观演人：** 观演人必须提前在大麦网账号中添加，且脚本中配置的姓名必须完全匹配。
5.  **多线程/多进程：** 本脚本为单线程实现。为避免被封禁，不建议用户自行修改为高并发多线程抢票。
